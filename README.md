# Моделирование движения на автостраде

Визуализация классического этюда для программиста - симуляция транспортного потока на автостраде.

## Описание

Приложение моделирует движение автомобилей на прямом участке автострады длиной 5 км. Реализована физика взаимодействия автомобилей: торможение при сближении, ускорение, соблюдение безопасной дистанции.

### Особенности симуляции

- **Длина дороги**: 5000 метров (5 км)
- **Диапазон скоростей**: настраиваемый (по умолчанию 50-80 км/ч)
- **Безопасная дистанция**: вычисляется динамически в зависимости от разницы скоростей
- **Торможение**: автоматическое при критическом сближении
- **Ускорение**: до целевой скорости при наличии свободного пространства
- **Real-time визуализация**: через WebSocket

## Требования

- Go 1.16 или выше
- Современный веб-браузер

## Установка и запуск

### 1. Клонирование/Переход в каталог

```bash
cd D:\Projects\Drive
```

### 2. Установка зависимостей

```bash
go mod download
```

### 3. Запуск приложения

```bash
go run main.go
```

Сервер запустится на `http://localhost:8080`

### 4. Альтернативный запуск (компиляция)

```bash
go build -o drive-simulation.exe
./drive-simulation.exe
```

## Использование

1. Откройте браузер и перейдите на `http://localhost:8080`
2. Используйте панель управления слева для настройки параметров:
   - **Скорость времени** (0.2x-20x) - множитель скорости симуляции
   - **Интервал создания машин** (0.5-5 сек) - частота появления новых автомобилей
   - **Мин. скорость** (30-80 км/ч) - минимальная целевая скорость для новых автомобилей
   - **Макс. скорость** (50-120 км/ч) - максимальная целевая скорость для новых автомобилей
   - **Макс. количество машин** (10-500) - после достижения этого числа генерация прекращается
3. Нажмите **Старт** для запуска симуляции
4. Наблюдайте за движением автомобилей на визуализации
5. Используйте **Стоп** для паузы и **Сброс** для начала заново
6. Симуляция автоматически остановится, когда все машины пройдут дорогу

## Визуализация

### Цвета автомобилей

- **Разноцветные** - нормальное движение
- **Красный** - торможение
- **Зеленый** - ускорение

### Индикаторы

- **Скорость** - отображается над каждым автомобилем (км/ч)
- **Торможения** - красный значок с числом показывает количество торможений (⚠N)

### Статистика

Панель управления отображает:
- Время симуляции (секунды)
- Количество машин на дороге
- Всего создано машин
- Машин, прошедших дорогу

## Технические детали

### Физика движения

- **Безопасная дистанция**: вычисляется по формуле, основанной на разнице скоростей, с коэффициентом безопасности 3.0
- **Торможение**: ускорение торможения составляет 6.67 м/с² (≈15 миль/ч за секунду)
- **Время реакции**: 0.2 секунды задержка перед торможением
- **Ускорение**: 2.0 м/с² при свободной дороге

### Логика управления скоростью автомобилей

#### 1. Назначение целевой скорости

При создании каждого нового автомобиля ему случайным образом назначается **целевая скорость** (TargetSpeed) в диапазоне между **Мин. скорость** и **Макс. скорость**:

```
TargetSpeed = MinSpeed + random(0..1) × (MaxSpeed - MinSpeed)
```

**Пример:** если MinSpeed = 50 км/ч, MaxSpeed = 80 км/ч, то новая машина может получить целевую скорость, например, 67 км/ч.

Начальная текущая скорость (Speed) равна целевой скорости.

#### 2. Когда автомобиль ускоряется

Автомобиль **ускоряется**, когда выполнены следующие условия:
- Текущая скорость **меньше** целевой скорости
- **И** одно из:
  - Впереди нет других автомобилей
  - Расстояние до впереди идущего автомобиля **больше** безопасной дистанции

**Параметры ускорения:**
- Ускорение: **2.0 м/с²** (≈7.2 км/ч за секунду)
- Скорость не может превысить целевую (TargetSpeed)

**Состояние:** автомобиль окрашивается в **зелёный цвет**

#### 3. Когда автомобиль тормозит

Автомобиль **тормозит**, когда:
- Впереди есть другой автомобиль
- **И** расстояние до него **меньше** безопасной дистанции

**Параметры торможения:**
- Замедление: **6.67 м/с²** (≈24 км/ч за секунду)
- Время реакции: **0.2 секунды** между последовательными торможениями
- Скорость не может быть отрицательной (минимум 0)
- Счётчик торможений увеличивается (отображается красным значком ⚠N)

**Состояние:** автомобиль окрашивается в **красный цвет**

#### 4. Нормальное движение

Когда автомобиль движется с **целевой скоростью** и расстояние до впереди идущего автомобиля безопасное:
- Скорость остаётся постоянной
- **Состояние:** автомобиль окрашивается в **свой базовый цвет**

#### 5. Вычисление безопасной дистанции

Безопасная дистанция зависит от **разницы скоростей** между текущим автомобилем и впереди идущим:

```
SpeedDiff = Speed(текущая) - Speed(впереди идущая)
SafeDistance = max(
    (|SpeedDiff| × 0.3м / 1.6) × SafetyMultiplier,
    CarLength × 2
)
```

Где:
- `SafetyMultiplier = 3.0` - коэффициент безопасности
- `CarLength = 4.5м` - длина автомобиля
- Минимальная безопасная дистанция = 9 метров (две длины машины)

**Важно:** чем больше разница скоростей, тем больше должна быть дистанция для безопасного торможения.

#### 6. Примеры сценариев

**Сценарий A: Свободная дорога**
- Машина создана с целевой скоростью 70 км/ч
- Впереди нет других машин
- Результат: машина движется с постоянной скоростью 70 км/ч (зелёная → базовый цвет)

**Сценарий B: Приближение к медленному автомобилю**
- Машина A: скорость 80 км/ч
- Машина B впереди: скорость 60 км/ч
- При сближении: машина A тормозит (красная), снижает скорость до ~60 км/ч
- После выравнивания скоростей: движутся на безопасной дистанции (базовый цвет)

**Сценарий C: Обгон быстрым потоком**
- Машина A: скорость 55 км/ч, целевая 55 км/ч
- Машина B впереди ушла вперёд
- Результат: машина A ускоряется обратно к 55 км/ч (зелёная → базовый цвет)

**Сценарий D: Каскадное торможение**
- Машина в начале цепочки тормозит
- Следующая машина тормозит с задержкой 0.2с
- Эффект "волны торможения" распространяется назад по цепочке

### Архитектура

- **Backend**: Go с использованием gorilla/websocket
- **Frontend**: Чистый HTML/CSS/JavaScript с Canvas API
- **Коммуникация**: WebSocket для real-time обновлений (50ms интервал)
- **Параллелизм**: goroutines для симуляции и broadcast

## Структура проекта

```
D:\Projects\Drive\
├── main.go           # Основная логика симуляции и веб-сервер
├── index.html        # Веб-интерфейс с визуализацией
├── go.mod            # Go модуль
├── go.sum            # Контрольные суммы зависимостей
└── README.md         # Документация
```

## Зависимости

- `github.com/gorilla/websocket` - для WebSocket коммуникации

## Возможные улучшения

- Добавление нескольких полос движения
- Реализация обгонов
- Добавление генератора возмущений (случайные торможения)
- Экспорт статистики в CSV/JSON
- Графики изменения скоростей во времени
- Настройка параметров физики (безопасная дистанция, торможение)

## Лицензия

Свободное использование в образовательных целях.

## Автор

Основано на классическом этюде "Моделирование движения на автостраде" из книги по программированию.
